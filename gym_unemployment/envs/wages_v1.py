'''

    wages.py

    rates for moving agents from state to another

'''

import numpy as np
import math
from scipy.interpolate import interp1d

class Wages_v1():
    def __init__(self,year: int=2018,silent: bool=True,max_age: float=70,n_groups: int=6,timestep: float=0.25,min_age: float=18,
                 inv_timestep: float=0,min_retirementage: float=65,min_salary: float=2_000,weights=None):
        self.year=year
        self.max_age=max_age
        self.min_age=min_age
        self.n_groups=n_groups
        self.timestep=timestep
        self.inv_timestep=inv_timestep
        self.silent=silent
        self.min_retirementage=min_retirementage
        self.min_salary=min_salary
        self.weights = weights
        
        self.setup_salaries(weights)

    def map_age(self,age,start_zero: bool=False):
        if start_zero:
            return int((age)*self.inv_timestep)
        else:
            return int((age-self.min_age)*self.inv_timestep)
    
    def get_salaries(self):
        self.setup_salaries(self.group_weights)
        return self.palkat_ika_miehet,self.palkat_ika_naiset,self.g_r_men,self.g_r_women

    def setup_salaries(self,weights):
        # TK:n aineisto vuodelta 2018
        # iät 18-70
        # päivitetty 2022
        
        if self.year==2018:
            palkat_ika_miehet=12.5*np.array([2039.15,2256.56,2339.01,2489.09,2571.40,2632.58,2718.03,2774.21,2884.89,2987.55,3072.40,3198.48,3283.81,3336.51,3437.30,3483.45,3576.67,3623.00,3731.27,3809.58,3853.66,3995.90,4006.16,4028.60,4104.72,4181.51,4134.13,4157.54,4217.15,4165.21,4141.23,4172.14,4121.26,4127.43,4134.00,4093.10,4065.53,4063.17,4085.31,4071.25,4026.50,4031.17,4047.32,4026.96,4028.39,4163.14,4266.42,4488.40,4201.40,4252.15,4443.96,3316.92,3536.03,3536.03])
            palkat_ika_naiset=12.5*np.array([2058.55,2166.68,2223.96,2257.10,2284.57,2365.57,2443.64,2548.35,2648.06,2712.89,2768.83,2831.99,2896.76,2946.37,2963.84,2993.79,3040.83,3090.43,3142.91,3159.91,3226.95,3272.29,3270.97,3297.32,3333.42,3362.99,3381.84,3342.78,3345.25,3360.21,3324.67,3322.28,3326.72,3326.06,3314.82,3303.73,3302.65,3246.03,3244.65,3248.04,3223.94,3211.96,3167.00,3156.29,3175.23,3228.67,3388.39,3457.17,3400.23,3293.52,2967.68,2702.05,2528.84,2528.84])
        elif self.year==2019:
            palkat_ika_miehet=12.5*np.array([2038.87,2333.74,2461.45,2497.86,2611.50,2683.02,2725.28,2832.99,2915.40,3013.90,3114.83,3195.78,3325.34,3388.91,3477.32,3539.94,3601.15,3690.42,3723.92,3862.93,3917.19,4017.50,4073.07,4149.53,4188.60,4212.02,4300.52,4272.58,4261.36,4323.13,4273.15,4224.92,4239.13,4187.86,4212.84,4174.39,4158.53,4164.68,4130.91,4135.94,4167.26,4134.85,4117.17,4133.90,4126.15,4101.47,4256.61,4368.19,4416.99,3916.29,4369.43,4044.96,3164.65,3922.97])
            palkat_ika_naiset=12.5*np.array([1925.76,2107.49,2187.98,2235.29,2283.07,2347.43,2417.19,2541.09,2638.73,2722.16,2796.34,2844.58,2907.21,2979.68,3032.32,3072.52,3109.08,3150.19,3225.29,3280.60,3332.80,3402.25,3466.92,3462.12,3491.58,3545.68,3593.33,3577.15,3603.15,3541.88,3524.54,3510.64,3515.35,3469.68,3484.29,3482.15,3476.69,3479.55,3408.25,3417.17,3428.42,3381.33,3360.57,3350.69,3291.61,3313.61,3461.04,3552.61,3583.39,3440.78,3038.59,2796.69,3320.12,2167.90])
        elif self.year==2020:
            palkat_ika_miehet=12.5*np.array([2090.10,2308.40,2346.80,2572.00,2624.90,2701.40,2766.50,2857.20,2967.90,3047.20,3156.70,3263.20,3334.20,3435.00,3556.90,3608.20,3665.50,3766.00,3819.00,3875.40,3957.00,4041.70,4138.00,4204.10,4253.20,4269.10,4323.20,4365.50,4345.50,4344.30,4417.40,4351.20,4315.00,4274.00,4300.90,4270.40,4250.50,4251.80,4223.40,4217.80,4170.30,4222.10,4178.20,4124.20,4208.80,4221.40,4362.80,4223.30,4386.80,4299.30,3844.90,3565.00,3919.70,3161.20]) #,3206.10,3405.60,3315.40,4280.90])
            palkat_ika_naiset=12.5*np.array([2046.60,2167.40,2304.80,2228.20,2291.90,2373.10,2473.10,2566.50,2682.50,2737.60,2832.80,2881.40,2934.20,2974.10,3042.60,3105.40,3155.90,3220.50,3253.20,3313.10,3373.10,3450.20,3472.80,3557.10,3566.80,3613.20,3667.60,3649.50,3653.90,3582.90,3595.60,3559.00,3550.10,3547.80,3530.30,3543.60,3534.80,3520.40,3511.90,3455.80,3443.00,3432.40,3396.00,3392.40,3368.70,3345.60,3479.20,3524.60,3540.90,3293.00,2903.10,2783.70,2573.50,2798.30]) #,2704.10,3117.20,3341.90
        elif self.year==2021:
            ind=1.021613
            palkat_ika_miehet=ind*12.5*np.array([2090.10,2308.40,2346.80,2572.00,2624.90,2701.40,2766.50,2857.20,2967.90,3047.20,3156.70,3263.20,3334.20,3435.00,3556.90,3608.20,3665.50,3766.00,3819.00,3875.40,3957.00,4041.70,4138.00,4204.10,4253.20,4269.10,4323.20,4365.50,4345.50,4344.30,4417.40,4351.20,4315.00,4274.00,4300.90,4270.40,4250.50,4251.80,4223.40,4217.80,4170.30,4222.10,4178.20,4124.20,4208.80,4221.40,4362.80,4223.30,4386.80,4299.30,3844.90,3565.00,3919.70,3161.20]) #,3206.10,3405.60,3315.40,4280.90])
            palkat_ika_naiset=ind*12.5*np.array([2046.60,2167.40,2304.80,2228.20,2291.90,2373.10,2473.10,2566.50,2682.50,2737.60,2832.80,2881.40,2934.20,2974.10,3042.60,3105.40,3155.90,3220.50,3253.20,3313.10,3373.10,3450.20,3472.80,3557.10,3566.80,3613.20,3667.60,3649.50,3653.90,3582.90,3595.60,3559.00,3550.10,3547.80,3530.30,3543.60,3534.80,3520.40,3511.90,3455.80,3443.00,3432.40,3396.00,3392.40,3368.70,3345.60,3479.20,3524.60,3540.90,3293.00,2903.10,2783.70,2573.50,2798.30]) #,2704.10,3117.20,3341.90
        elif self.year==2022:
            ind=1.021613*1.022646
            palkat_ika_miehet=ind*12.5*np.array([2090.10,2308.40,2346.80,2572.00,2624.90,2701.40,2766.50,2857.20,2967.90,3047.20,3156.70,3263.20,3334.20,3435.00,3556.90,3608.20,3665.50,3766.00,3819.00,3875.40,3957.00,4041.70,4138.00,4204.10,4253.20,4269.10,4323.20,4365.50,4345.50,4344.30,4417.40,4351.20,4315.00,4274.00,4300.90,4270.40,4250.50,4251.80,4223.40,4217.80,4170.30,4222.10,4178.20,4124.20,4208.80,4221.40,4362.80,4223.30,4386.80,4299.30,3844.90,3565.00,3919.70,3161.20]) #,3206.10,3405.60,3315.40,4280.90])
            palkat_ika_naiset=ind*12.5*np.array([2046.60,2167.40,2304.80,2228.20,2291.90,2373.10,2473.10,2566.50,2682.50,2737.60,2832.80,2881.40,2934.20,2974.10,3042.60,3105.40,3155.90,3220.50,3253.20,3313.10,3373.10,3450.20,3472.80,3557.10,3566.80,3613.20,3667.60,3649.50,3653.90,3582.90,3595.60,3559.00,3550.10,3547.80,3530.30,3543.60,3534.80,3520.40,3511.90,3455.80,3443.00,3432.40,3396.00,3392.40,3368.70,3345.60,3479.20,3524.60,3540.90,3293.00,2903.10,2783.70,2573.50,2798.30]) #,2704.10,3117.20,3341.90
        elif self.year==2023:
            ind=1.021613*1.022646*1.030886
            palkat_ika_miehet=ind*12.5*np.array([2090.10,2308.40,2346.80,2572.00,2624.90,2701.40,2766.50,2857.20,2967.90,3047.20,3156.70,3263.20,3334.20,3435.00,3556.90,3608.20,3665.50,3766.00,3819.00,3875.40,3957.00,4041.70,4138.00,4204.10,4253.20,4269.10,4323.20,4365.50,4345.50,4344.30,4417.40,4351.20,4315.00,4274.00,4300.90,4270.40,4250.50,4251.80,4223.40,4217.80,4170.30,4222.10,4178.20,4124.20,4208.80,4221.40,4362.80,4223.30,4386.80,4299.30,3844.90,3565.00,3919.70,3161.20]) #,3206.10,3405.60,3315.40,4280.90])
            palkat_ika_naiset=ind*12.5*np.array([2046.60,2167.40,2304.80,2228.20,2291.90,2373.10,2473.10,2566.50,2682.50,2737.60,2832.80,2881.40,2934.20,2974.10,3042.60,3105.40,3155.90,3220.50,3253.20,3313.10,3373.10,3450.20,3472.80,3557.10,3566.80,3613.20,3667.60,3649.50,3653.90,3582.90,3595.60,3559.00,3550.10,3547.80,3530.30,3543.60,3534.80,3520.40,3511.90,3455.80,3443.00,3432.40,3396.00,3392.40,3368.70,3345.60,3479.20,3524.60,3540.90,3293.00,2903.10,2783.70,2573.50,2798.30]) #,2704.10,3117.20,3341.90
        elif self.year==2024:
            ind=1.021613*1.022646*1.030886*1.03957
            palkat_ika_miehet=ind*12.5*np.array([2090.10,2308.40,2346.80,2572.00,2624.90,2701.40,2766.50,2857.20,2967.90,3047.20,3156.70,3263.20,3334.20,3435.00,3556.90,3608.20,3665.50,3766.00,3819.00,3875.40,3957.00,4041.70,4138.00,4204.10,4253.20,4269.10,4323.20,4365.50,4345.50,4344.30,4417.40,4351.20,4315.00,4274.00,4300.90,4270.40,4250.50,4251.80,4223.40,4217.80,4170.30,4222.10,4178.20,4124.20,4208.80,4221.40,4362.80,4223.30,4386.80,4299.30,3844.90,3565.00,3919.70,3161.20]) #,3206.10,3405.60,3315.40,4280.90])
            palkat_ika_naiset=ind*12.5*np.array([2046.60,2167.40,2304.80,2228.20,2291.90,2373.10,2473.10,2566.50,2682.50,2737.60,2832.80,2881.40,2934.20,2974.10,3042.60,3105.40,3155.90,3220.50,3253.20,3313.10,3373.10,3450.20,3472.80,3557.10,3566.80,3613.20,3667.60,3649.50,3653.90,3582.90,3595.60,3559.00,3550.10,3547.80,3530.30,3543.60,3534.80,3520.40,3511.90,3455.80,3443.00,3432.40,3396.00,3392.40,3368.70,3345.60,3479.20,3524.60,3540.90,3293.00,2903.10,2783.70,2573.50,2798.30]) #,2704.10,3117.20,3341.90
        elif self.year==2025:
            ind=1.021613*1.022646*1.030886*1.03957*1.032
            palkat_ika_miehet=ind*12.5*np.array([2090.10,2308.40,2346.80,2572.00,2624.90,2701.40,2766.50,2857.20,2967.90,3047.20,3156.70,3263.20,3334.20,3435.00,3556.90,3608.20,3665.50,3766.00,3819.00,3875.40,3957.00,4041.70,4138.00,4204.10,4253.20,4269.10,4323.20,4365.50,4345.50,4344.30,4417.40,4351.20,4315.00,4274.00,4300.90,4270.40,4250.50,4251.80,4223.40,4217.80,4170.30,4222.10,4178.20,4124.20,4208.80,4221.40,4362.80,4223.30,4386.80,4299.30,3844.90,3565.00,3919.70,3161.20]) #,3206.10,3405.60,3315.40,4280.90])
            palkat_ika_naiset=ind*12.5*np.array([2046.60,2167.40,2304.80,2228.20,2291.90,2373.10,2473.10,2566.50,2682.50,2737.60,2832.80,2881.40,2934.20,2974.10,3042.60,3105.40,3155.90,3220.50,3253.20,3313.10,3373.10,3450.20,3472.80,3557.10,3566.80,3613.20,3667.60,3649.50,3653.90,3582.90,3595.60,3559.00,3550.10,3547.80,3530.30,3543.60,3534.80,3520.40,3511.90,3455.80,3443.00,3432.40,3396.00,3392.40,3368.70,3345.60,3479.20,3524.60,3540.90,3293.00,2903.10,2783.70,2573.50,2798.30]) #,2704.10,3117.20,3341.90
        elif self.year==2026:
            ind=1.021613*1.022646*1.030886*1.03957*1.032*1.038
            palkat_ika_miehet=ind*12.5*np.array([2090.10,2308.40,2346.80,2572.00,2624.90,2701.40,2766.50,2857.20,2967.90,3047.20,3156.70,3263.20,3334.20,3435.00,3556.90,3608.20,3665.50,3766.00,3819.00,3875.40,3957.00,4041.70,4138.00,4204.10,4253.20,4269.10,4323.20,4365.50,4345.50,4344.30,4417.40,4351.20,4315.00,4274.00,4300.90,4270.40,4250.50,4251.80,4223.40,4217.80,4170.30,4222.10,4178.20,4124.20,4208.80,4221.40,4362.80,4223.30,4386.80,4299.30,3844.90,3565.00,3919.70,3161.20]) #,3206.10,3405.60,3315.40,4280.90])
            palkat_ika_naiset=ind*12.5*np.array([2046.60,2167.40,2304.80,2228.20,2291.90,2373.10,2473.10,2566.50,2682.50,2737.60,2832.80,2881.40,2934.20,2974.10,3042.60,3105.40,3155.90,3220.50,3253.20,3313.10,3373.10,3450.20,3472.80,3557.10,3566.80,3613.20,3667.60,3649.50,3653.90,3582.90,3595.60,3559.00,3550.10,3547.80,3530.30,3543.60,3534.80,3520.40,3511.90,3455.80,3443.00,3432.40,3396.00,3392.40,3368.70,3345.60,3479.20,3524.60,3540.90,3293.00,2903.10,2783.70,2573.50,2798.30]) #,2704.10,3117.20,3341.90
        else:
            print('Unknown year ',self.year)
            error(1001)
            
        def map_age18(x):
            return int(x-18)
            
        def ifunc(palkat,x1,x2):
            x = np.linspace(18, 72, num=54, endpoint=True)
            f = interp1d(x, palkat, fill_value='extrapolate')
            n_time = int(np.round((x2-x1)*self.inv_timestep))+2
            palkat_x = np.linspace(x1, x2, num=n_time, endpoint=True)
        
            return f(palkat_x)        

        def gfunc(palkat,x1,x2):
            x = np.linspace(18, 73, num=55, endpoint=True)
            n_time = int(np.round((x2-x1)*self.inv_timestep))+2
            palkat_x = np.linspace(x1, x2, num=n_time, endpoint=True)
            g=np.zeros((n_time,3))
            for k in range(3):
                f = interp1d(x, palkat[:,k],fill_value='extrapolate')
                g[:,k]=f(palkat_x)
        
            return g
        
        # filtteri
        m_age=int(self.min_retirementage-1)
        palkat_miehet_ve=palkat_ika_miehet[map_age18(m_age)]
        palkat_ika_miehet[map_age18(m_age):]=np.minimum(palkat_ika_miehet[map_age18(m_age):],palkat_miehet_ve)
        palkat_naiset_ve=palkat_ika_naiset[map_age18(m_age)]
        palkat_ika_naiset[map_age18(m_age):]=np.minimum(palkat_ika_naiset[map_age18(m_age):],palkat_naiset_ve)

        self.palkat_ika_miehet=ifunc(palkat_ika_miehet,self.min_age,self.max_age)
        self.palkat_ika_naiset=ifunc(palkat_ika_naiset,self.min_age,self.max_age)
        
        #g_r=np.array([[0.81436,1.00992,1.2469],[0.81436,1.00992,1.2469],[0.81436,1.00992,1.2469],[0.8144725,1.011105,1.2677425],[0.814585,1.01229,1.288585],[0.8146975,1.013475,1.3094275],[0.81481,1.01466,1.33027],[0.81481,1.01466,1.33027],[0.798635,1.0116225,1.34756],[0.78246,1.008585,1.36485],[0.766285,1.0055475,1.38214],[0.75011,1.00251,1.39943],[0.75011,1.00251,1.39943],[0.74420478,0.99822499,1.40395702],[0.73829957,0.99393997,1.40848403],[0.73239435,0.98965496,1.41301105],[0.72648913,0.98536995,1.41753806],[0.72058391,0.98108493,1.42206508],[0.7146787,0.97679992,1.4265921],[0.70877348,0.9725149,1.43111911],[0.70286826,0.96822989,1.43564613],[0.69696304,0.96394488,1.44017314],[0.69105783,0.95965986,1.44470016],[0.68515261,0.95537485,1.44922718],[0.67924739,0.95108984,1.45375419],[0.67334218,0.94680482,1.45828121],[0.66743696,0.94251981,1.46280822],[0.66153174,0.93823479,1.46733524],[0.65562652,0.93394978,1.47186226],[0.64972131,0.92966477,1.47638927],[0.64381609,0.92537975,1.48091629],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433],[0.63791087,0.92109474,1.4854433]])
        #g_r=np.array([[0.81436,0.984635,1.191381],[0.81436,0.984635,1.191381],[0.81436,0.984635,1.191381],[0.8144724999999999,0.9851000000000001,1.20802225],[0.814585,0.985565,1.2246635000000001],[0.8146975000000001,0.98603,1.24130475],[0.81481,0.986495,1.257946],[0.81481,0.986495,1.257946],[0.798635,0.9817215,1.2668175],[0.78246,0.9769479999999999,1.2756889999999999],[0.7662850000000001,0.9721744999999999,1.2845605],[0.75011,0.967401,1.293432],[0.75011,0.967401,1.293432],[0.7442047827368421,0.9625178421052631,1.2952514736842105],[0.7382995654736842,0.9576346842105262,1.297070947368421],[0.7323943482105264,0.9527515263157894,1.2988904210526315],[0.7264891309473684,0.9478683684210526,1.300709894736842],[0.7205839136842106,0.9429852105263158,1.3025293684210526],[0.7146786964210526,0.9381020526315789,1.3043488421052631],[0.7087734791578948,0.933218894736842,1.3061683157894737],[0.7028682618947368,0.9283357368421052,1.3079877894736842],[0.696963044631579,0.9234525789473684,1.3098072631578948],[0.691057827368421,0.9185694210526315,1.311626736842105],[0.6851526101052632,0.9136862631578947,1.3134462105263156],[0.6792473928421052,0.9088031052631579,1.3152656842105261],[0.6733421755789474,0.9039199473684211,1.3170851578947367],[0.6674369583157894,0.8990367894736842,1.3189046315789472],[0.6615317410526316,0.8941536315789473,1.3207241052631578],[0.6556265237894737,0.8892704736842105,1.3225435789473683],[0.6497213065263158,0.8843873157894737,1.3243630526315788],[0.6438160892631579,0.8795041578947368,1.3261825263157894],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002],[0.637910872,0.874621,1.328002]])

        #g_r_men=np.array([[0.854128551,1.0,1.166358177],[0.854128551,1.0,1.166358177],[0.854128551,1.0,1.166358177],[0.85408886775,1.0,1.1791700812500001],[0.8540491845,1.0,1.1919819855],[0.85400950125,1.0,1.20479388975],[0.853969818,1.0,1.217605794],[0.853969818,1.0,1.217605794],[0.8435630445,1.0,1.2281400315],[0.833156271,1.0,1.238674269],[0.8227494975,1.0,1.2492085065],[0.812342724,1.0,1.259742744],[0.812342724,1.0,1.259742744],[0.8100126297894736,1.0,1.2669277252631579],[0.8076825355789473,1.0,1.2741127065263158],[0.805352441368421,1.0,1.2812976877894737],[0.8030223471578947,1.0,1.2884826690526316],[0.8006922529473685,1.0,1.2956676503157896],[0.7983621587368421,1.0,1.3028526315789473],[0.7960320645263158,1.0,1.3100376128421052],[0.7937019703157895,1.0,1.317222594105263],[0.7913718761052632,1.0,1.324407575368421],[0.7890417818947368,1.0,1.331592556631579],[0.7867116876842105,1.0,1.3387775378947369],[0.7843815934736842,1.0,1.3459625191578948],[0.7820514992631579,1.0,1.3531475004210527],[0.7797214050526315,1.0,1.3603324816842104],[0.7773913108421053,1.0,1.3675174629473683],[0.775061216631579,1.0,1.3747024442105262],[0.7727311224210527,1.0,1.3818874254736842],[0.7704010282105264,1.0,1.389072406736842],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388]])
        #g_r_women=np.array([[0.854128551,1.0,1.166358177],[0.854128551,1.0,1.166358177],[0.854128551,1.0,1.166358177],[0.85408886775,1.0,1.1791700812500001],[0.8540491845,1.0,1.1919819855],[0.85400950125,1.0,1.20479388975],[0.853969818,1.0,1.217605794],[0.853969818,1.0,1.217605794],[0.8435630445,1.0,1.2281400315],[0.833156271,1.0,1.238674269],[0.8227494975,1.0,1.2492085065],[0.812342724,1.0,1.259742744],[0.812342724,1.0,1.259742744],[0.8100126297894736,1.0,1.2669277252631579],[0.8076825355789473,1.0,1.2741127065263158],[0.805352441368421,1.0,1.2812976877894737],[0.8030223471578947,1.0,1.2884826690526316],[0.8006922529473685,1.0,1.2956676503157896],[0.7983621587368421,1.0,1.3028526315789473],[0.7960320645263158,1.0,1.3100376128421052],[0.7937019703157895,1.0,1.317222594105263],[0.7913718761052632,1.0,1.324407575368421],[0.7890417818947368,1.0,1.331592556631579],[0.7867116876842105,1.0,1.3387775378947369],[0.7843815934736842,1.0,1.3459625191578948],[0.7820514992631579,1.0,1.3531475004210527],[0.7797214050526315,1.0,1.3603324816842104],[0.7773913108421053,1.0,1.3675174629473683],[0.775061216631579,1.0,1.3747024442105262],[0.7727311224210527,1.0,1.3818874254736842],[0.7704010282105264,1.0,1.389072406736842],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388],[0.768070934,1.0,1.396257388]])

        g_r_men=np.array([[1.0,1.0,1.0],[1.0,1.0082407055,1.036358943],[1.0,1.016481411,1.072717886],[0.9722115755,1.016481411,1.072717886],[0.944423151,1.016481411,1.072717886],[0.9374280272,0.9971338162,1.07443862],[0.9304329034,0.9777862214,1.076159354],[0.9234377796,0.9584386266,1.077880088],[0.9164426558,0.9390910318000001,1.079600822],[0.909447532,0.919743437,1.081321556],[0.9082448468,0.9125427166000001,1.0850967572],[0.9070421616,0.9053419962,1.0888719584],[0.9058394764,0.8981412758,1.0926471596],[0.9046367912,0.8909405554,1.0964223607999999],[0.903434106,0.883739835,1.100197562],[0.9003390774,0.8779168212,1.1035881328],[0.8972440488,0.8720938074,1.1069787036],[0.8941490202,0.8662707936,1.1103692744],[0.8910539916,0.8604477798,1.1137598452000002],[0.887958963,0.854624766,1.117150416],[0.8803041186,0.850851606,1.1191980856000001],[0.8726492742,0.847078446,1.1212457552000001],[0.8649944298,0.843305286,1.1232934248],[0.8573395854,0.839532126,1.1253410944],[0.849684741,0.835758966,1.127388764],[0.8424431054,0.8373635916,1.1378785592],[0.8352014698,0.8389682172,1.1483683544],[0.8279598342000001,0.8405728428,1.1588581495999999],[0.8207181986000001,0.8421774684000001,1.1693479448],[0.813476563,0.843782094,1.17983774],[0.8119551690000001,0.8455169046666667,1.1918104508],[0.810433775,0.8472517153333333,1.2037831615999999],[0.8089123810000001,0.848986526,1.2157558724],[0.807390987,0.8507213366666667,1.2277285832],[0.805869593,0.8524561473333334,1.239701294],[0.804348199,0.854190958,1.2516740048],[0.802826805,0.8559257686666667,1.2636467156],[0.801305411,0.8576605793333334,1.2756194264],[0.799784017,0.8593953900000001,1.2875921372],[0.798262623,0.8611302006666667,1.299564848],[0.796741229,0.8628650113333334,1.3115375588],[0.7952198349999999,0.8645998220000001,1.3235102696],[0.793698441,0.8663346326666668,1.3354829804000001],[0.7921770469999999,0.8680694433333334,1.3474556912],[0.790655653,0.869804254,1.359428402],[0.7868130698,0.8593615562000001,1.3518988534],[0.7829704866,0.8489188584,1.3443693048],[0.7791279033999999,0.8384761606000001,1.3368397562],[0.7752853202,0.8280334628,1.3293102076],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659]])
                          #[0.82707,1.0,1.20997],[0.82707,1.0,1.20997],[0.82707,1.0,1.20997],[0.8267925,1.0,1.22627],[0.826515,1.0,1.24257],[0.8262375,1.0,1.25887],[0.82596,1.0,1.27517],[0.82596,1.0,1.27517],[0.8133175,1.0,1.2906325],[0.800675,1.0,1.306095],[0.7880325,1.0,1.3215575],[0.77539,1.0,1.33702],[0.77539,1.0,1.33702],[0.7729671890526316,1.0,1.3465649511578948],[0.7705443781052632,1.0,1.3561099023157897],[0.7681215671578948,1.0,1.3656548534736843],[0.7656987562105263,1.0,1.375199804631579],[0.7632759452631579,1.0,1.3847447557894739],[0.7608531343157895,1.0,1.3942897069473685],[0.7584303233684211,1.0,1.4038346581052632],[0.7560075124210527,1.0,1.4133796092631579],[0.7535847014736843,1.0,1.4229245604210528],[0.7511618905263158,1.0,1.4324695115789474],[0.7487390795789474,1.0,1.4420144627368423],[0.746316268631579,1.0,1.451559413894737],[0.7438934576842106,1.0,1.4611043650526316],[0.7414706467368422,1.0,1.4706493162105263],[0.7390478357894738,1.0,1.4801942673684212],[0.7366250248421053,1.0,1.4897392185263159],[0.7342022138947368,1.0,1.4992841696842105],[0.7317794029473684,1.0,1.5088291208421054],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072],[0.729356592,1.0,1.518374072]])
        g_r_women=np.array([[1.0,1.0,1.0],[1.0,1.0082407055,1.036358943],[1.0,1.016481411,1.072717886],[0.9722115755,1.016481411,1.072717886],[0.944423151,1.016481411,1.072717886],[0.9374280272,0.9971338162,1.07443862],[0.9304329034,0.9777862214,1.076159354],[0.9234377796,0.9584386266,1.077880088],[0.9164426558,0.9390910318000001,1.079600822],[0.909447532,0.919743437,1.081321556],[0.9082448468,0.9125427166000001,1.0850967572],[0.9070421616,0.9053419962,1.0888719584],[0.9058394764,0.8981412758,1.0926471596],[0.9046367912,0.8909405554,1.0964223607999999],[0.903434106,0.883739835,1.100197562],[0.9003390774,0.8779168212,1.1035881328],[0.8972440488,0.8720938074,1.1069787036],[0.8941490202,0.8662707936,1.1103692744],[0.8910539916,0.8604477798,1.1137598452000002],[0.887958963,0.854624766,1.117150416],[0.8803041186,0.850851606,1.1191980856000001],[0.8726492742,0.847078446,1.1212457552000001],[0.8649944298,0.843305286,1.1232934248],[0.8573395854,0.839532126,1.1253410944],[0.849684741,0.835758966,1.127388764],[0.8424431054,0.8373635916,1.1378785592],[0.8352014698,0.8389682172,1.1483683544],[0.8279598342000001,0.8405728428,1.1588581495999999],[0.8207181986000001,0.8421774684000001,1.1693479448],[0.813476563,0.843782094,1.17983774],[0.8119551690000001,0.8455169046666667,1.1918104508],[0.810433775,0.8472517153333333,1.2037831615999999],[0.8089123810000001,0.848986526,1.2157558724],[0.807390987,0.8507213366666667,1.2277285832],[0.805869593,0.8524561473333334,1.239701294],[0.804348199,0.854190958,1.2516740048],[0.802826805,0.8559257686666667,1.2636467156],[0.801305411,0.8576605793333334,1.2756194264],[0.799784017,0.8593953900000001,1.2875921372],[0.798262623,0.8611302006666667,1.299564848],[0.796741229,0.8628650113333334,1.3115375588],[0.7952198349999999,0.8645998220000001,1.3235102696],[0.793698441,0.8663346326666668,1.3354829804000001],[0.7921770469999999,0.8680694433333334,1.3474556912],[0.790655653,0.869804254,1.359428402],[0.7868130698,0.8593615562000001,1.3518988534],[0.7829704866,0.8489188584,1.3443693048],[0.7791279033999999,0.8384761606000001,1.3368397562],[0.7752853202,0.8280334628,1.3293102076],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659],[0.771442737,0.817590765,1.321780659]])

        g_r_men=np.array([[1.0,1.0,1.0],[0.9838319497687997,0.9919394191283352,1.0196030395520224],[0.9681783928799537,0.9841353388943277,1.0385822788810612],[0.9477842198802607,0.9909417511840988,1.0457652535264557],[0.9271059845839013,0.9978429672743041,1.0530482769590546],[0.9279628548727151,0.9870657969709541,1.063590057338858],[0.928834230636519,0.9761061860154527,1.0743102935872415],[0.9297204833521107,0.9649594622085625,1.085213555855448],[0.9306219972899068,0.9536207924410272,1.0963045716902182],[0.9315391700694904,0.9420851757062558,1.1075882328684907],[0.9318822639770837,0.9362919874713749,1.1133368125306804],[0.9322265215586708,0.9304791504396475,1.11910488969051],[0.9325719487445704,0.9246465644768191,1.124892563711183],[0.9329185515054657,0.9187941287670713,1.1306999346322175],[0.933266335852749,0.9129217418072137,1.1365271031752122],[0.9317559716618218,0.9085513017358942,1.1420973040079216],[0.9302401188250482,0.904164979536351,1.1476877468854625],[0.928718747369455,0.8997626884777922,1.1532985423477162],[0.9271918271034317,0.895344341196769,1.1589298017408975],[0.9256593276147334,0.8909098496913972,1.1645816372249174],[0.9202048320246516,0.8894173532009817,1.1699269202554199],[0.9147202332494002,0.8879166196705919,1.1753017037304996],[0.9092052813916298,0.8864075807216012,1.18070623254394],[0.9036597237803327,0.8848901672164355,1.1861407543076468],[0.8980833049322535,0.8833643092480142,1.1916055193894655],[0.887988972091087,0.8826348393204912,1.199396856205187],[0.8779498148097366,0.8819093566710039,1.2071456056228818],[0.867965381937302,0.8811878286969994,1.2148521158645342],[0.8580352272280473,0.8804702231503991,1.222516731366066],[0.8481589092749168,0.879756508132792,1.2301397928286506],[0.8424857662397347,0.8773094679279582,1.236624113239387],[0.8368671349832628,0.8748859407058419,1.2430461274757285],[0.8313022335775893,0.8724855891914924,1.2494067292699658],[0.825790294978479,0.8701080825298495,1.255706795342562],[0.8203305666729203,0.8677530961337162,1.2619471858050022],[0.8149223103366388,0.8654203115360326,1.26812874455125],[0.8095648015012538,0.8631094162463073,1.274252299638183],[0.8042573292307591,0.8608201036110716,1.28031866365537],[0.7989991958070285,0.8585520726782262,1.2863286340845357],[0.7937897164240473,0.8563050280651514,1.2922829936490465],[0.7886282188905974,0.8540786798304646,1.29818251065374],[0.7835140433411166,0.8518727433493026,1.3040279393154064],[0.7784465419544759,0.8496869391920198,1.309820020084224],[0.7734250786804209,0.8475209930061917,1.3155594799564307],[0.7684490289734359,0.8453746354018212,1.3212470327785157],[0.7704735706371639,0.8415154654739365,1.3238243957794837],[0.7725288380732928,0.8375977262515863,1.326440874532121],[0.7746155361019461,0.8336200742106172,1.329097366314731],[0.77673439126656,0.8295811244180189,1.3317947960606962],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032]])
        g_r_women=np.array([[1.0,1.0,1.0],[0.9838319497687997,0.9919394191283352,1.0196030395520224],[0.9681783928799537,0.9841353388943277,1.0385822788810612],[0.9477842198802607,0.9909417511840988,1.0457652535264557],[0.9271059845839013,0.9978429672743041,1.0530482769590546],[0.9279628548727151,0.9870657969709541,1.063590057338858],[0.928834230636519,0.9761061860154527,1.0743102935872415],[0.9297204833521107,0.9649594622085625,1.085213555855448],[0.9306219972899068,0.9536207924410272,1.0963045716902182],[0.9315391700694904,0.9420851757062558,1.1075882328684907],[0.9318822639770837,0.9362919874713749,1.1133368125306804],[0.9322265215586708,0.9304791504396475,1.11910488969051],[0.9325719487445704,0.9246465644768191,1.124892563711183],[0.9329185515054657,0.9187941287670713,1.1306999346322175],[0.933266335852749,0.9129217418072137,1.1365271031752122],[0.9317559716618218,0.9085513017358942,1.1420973040079216],[0.9302401188250482,0.904164979536351,1.1476877468854625],[0.928718747369455,0.8997626884777922,1.1532985423477162],[0.9271918271034317,0.895344341196769,1.1589298017408975],[0.9256593276147334,0.8909098496913972,1.1645816372249174],[0.9202048320246516,0.8894173532009817,1.1699269202554199],[0.9147202332494002,0.8879166196705919,1.1753017037304996],[0.9092052813916298,0.8864075807216012,1.18070623254394],[0.9036597237803327,0.8848901672164355,1.1861407543076468],[0.8980833049322535,0.8833643092480142,1.1916055193894655],[0.887988972091087,0.8826348393204912,1.199396856205187],[0.8779498148097366,0.8819093566710039,1.2071456056228818],[0.867965381937302,0.8811878286969994,1.2148521158645342],[0.8580352272280473,0.8804702231503991,1.222516731366066],[0.8481589092749168,0.879756508132792,1.2301397928286506],[0.8424857662397347,0.8773094679279582,1.236624113239387],[0.8368671349832628,0.8748859407058419,1.2430461274757285],[0.8313022335775893,0.8724855891914924,1.2494067292699658],[0.825790294978479,0.8701080825298495,1.255706795342562],[0.8203305666729203,0.8677530961337162,1.2619471858050022],[0.8149223103366388,0.8654203115360326,1.26812874455125],[0.8095648015012538,0.8631094162463073,1.274252299638183],[0.8042573292307591,0.8608201036110716,1.28031866365537],[0.7989991958070285,0.8585520726782262,1.2863286340845357],[0.7937897164240473,0.8563050280651514,1.2922829936490465],[0.7886282188905974,0.8540786798304646,1.29818251065374],[0.7835140433411166,0.8518727433493026,1.3040279393154064],[0.7784465419544759,0.8496869391920198,1.309820020084224],[0.7734250786804209,0.8475209930061917,1.3155594799564307],[0.7684490289734359,0.8453746354018212,1.3212470327785157],[0.7704735706371639,0.8415154654739365,1.3238243957794837],[0.7725288380732928,0.8375977262515863,1.326440874532121],[0.7746155361019461,0.8336200742106172,1.329097366314731],[0.77673439126656,0.8295811244180189,1.3317947960606962],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032],[0.7788861526773014,0.8254794489242067,1.3345341174322032]])
        if weights is not None: # scale wages factors to make sure that mean is invariant with respect to weights of the groups
            women=weights[1,:]
            men=weights[0,:]
            rr_women=np.sum(women*g_r_women,1)/1.02 # kerroin säätää tason havaituksi
            rr_men=np.sum(men*g_r_men,1)/1.05 # kerroin säätää tason havaituksi
            for k in range(3):
                g_r_men[:,k] /= rr_men
                g_r_women[:,k] /= rr_women

        self.g_r_men = gfunc(g_r_men,self.min_age,self.max_age)
        self.g_r_women = gfunc(g_r_women,self.min_age,self.max_age)
    
    def wage_process_TK_v4(self,w: float,a0: float=3300*12,a1: float=3300*12,g: int=1):
        '''
        Palkkaprosessi muokattu lähteestä Määttänen, 2013 
        '''
        #group_sigmas=np.array([0.05,0.07,0.10])*math.sqrt(self.timestep)
        if g<3:
            group_sigmas=np.array([0.05,0.07,0.10])*math.sqrt(self.timestep)
        else:
            group_sigmas=np.array([0.05,0.06,0.08])*math.sqrt(self.timestep)
        sigma=group_sigmas[g]
        eps=np.random.normal(loc=0,scale=sigma,size=1)[0]
        c1=0.89**self.timestep
        if w>0:
             # pidetään keskiarvo/a1 samana kuin w/a0
            wt=a1*math.exp(c1*np.log(w/a0)+eps-0.5*sigma*sigma)
        else:
            wt=a1*math.exp(eps)

        # täysiaikainen vuositulo vähintään self.min_salary
        wt=max(self.min_salary,wt)

        return wt
                
    def compute_salary(self,group: int=1,debug: bool=False,initial_salary: float=None):
        '''
        Alussa ajettava funktio, joka tekee palkat yhtä episodia varten
        '''
        n_time = int(np.round((self.max_age-self.min_age)*self.inv_timestep))+2
        salary=np.zeros(n_time)

        if group>2: # naiset
            r=self.g_r_women[0,group-3]
            if initial_salary is not None:
                a0=initial_salary
            else:
                a0=self.palkat_ika_naiset[0]*r
            
            a1=self.palkat_ika_naiset[0]*r/5
            salary[0]=np.maximum(self.min_salary,np.random.normal(loc=a0,scale=a1,size=1)[0]) # e/y

            k=0
            r0=self.g_r_women[0,group-3]
            a0=self.palkat_ika_naiset[0]*r0
            s0=salary[0]
            for age in np.arange(self.min_age,self.max_age,self.timestep):
                r1=self.g_r_women[k,group-3]
                a1=self.palkat_ika_naiset[k]*r1
                salary[self.map_age(age)]=self.wage_process_TK_v4(s0,a0,a1,g=group-3)
                k=k+1
                s0=salary[self.map_age(age)]
                a0=a1
                r0=r1
        else: # miehet
            r=self.g_r_men[0,group]
            if initial_salary is not None:
                a0=initial_salary
            else:
                a0=self.palkat_ika_miehet[0]*r
                
            a1=self.palkat_ika_miehet[0]*r/5
            salary[0]=np.maximum(self.min_salary,np.random.normal(loc=a0,scale=a1,size=1)[0]) # e/y

            k=0
            r0=self.g_r_men[0,group]
            a0=self.palkat_ika_miehet[0]*r0
            s0=salary[0]
            for age in np.arange(self.min_age,self.max_age,self.timestep):
                r1=self.g_r_men[k,group]
                a1=self.palkat_ika_miehet[k]*r1
                salary[self.map_age(age)]=self.wage_process_TK_v4(s0,a0,a1,g=group)
                k=k+1
                s0=salary[self.map_age(age)]
                a0=a1
                r0=r1
                
        self.salary=salary

    def get_wage(self,age: float,reduction: float):
        '''
        palkka age-ikäiselle time_in_state-vähennyksellä työllistymispalkkaan, step-kohtaisesti, ei vuosikohtaisesti
        '''
        intage=self.map_age(age)
        if age<self.max_age and age>=self.min_age-1:
            return np.maximum(self.min_salary,self.salary[intage])*max(0,(1-reduction))
        else:
            return 0
            
    def get_potential_wage(self,age: float):
        '''
        palkka age-ikäiselle ILMAN time_in_state-vähennystä työllistymispalkkaan, step-kohtaisesti, ei vuosikohtaisesti
        '''
        intage=self.map_age(age)
        if age<self.max_age and age>=self.min_age-1:
            return np.maximum(self.min_salary,self.salary[intage])
        else:
            return 0
            
            